function displayMenu(){$("#form-section").load("/reportes/partial-view/menu")}function displayForm(e){currentReportTypeId=e;const t=`/reportes/partial-view/formulario?tipoReporteId=${e}`;$("#body-modal").load(t,null,onFormularioLoadedCompleted)}function displayTable(){const e="/reportes/partial-view/ultimos-reportes";$("#table-section").load(e)}function onFormularioLoadedCompleted(e,t,o){$("#Observaciones").trumbowyg({svgPath:"../img/svg/icons.svg",btns:[["formatting"],["strong","em","del"],["superscript","subscript"],["link"],["base64"],["justifyLeft","justifyCenter","justifyRight","justifyFull"],["unorderedList","orderedList"],["emoji"]]}),modal.show()}function submitNuevoReporte(e){e.preventDefault();const t="/reportes",o="POST",a=$(e.target);$("span.text-danger").text(""),$.ajax({url:t,type:o,data:a.serialize(),success:function(e){modal.hide();var{folio:t}=e;Swal.fire({title:"Reporte almacenado",text:`Folio: ${t}`,icon:"success",confirmButtonText:"Aceptar"}).then(e=>{window.location.reload()})},error:function(e,t,o){if(console.error(e,o),422==e.status){const{errors:t}=e.responseJSON;t.forEach(e=>{const t=$(`span[data-valmsg-for="${e.field}"]`);t.text(e.message)})}else{let t="Error no controlado al registrar la entrada";if(e.responseJSON){const{title:o}=e.responseJSON;o&&(t=o)}Swal.fire({title:t,icon:"error"})}}})}function uploadAttachFile(e){const t="/reportes/upload-attach-file",o=e.target;if(0===o.files.length)return;const a=10485760;if(o.files[0].size>a)return Swal.fire({title:"Archivo demasiado grande",text:"El archivo debe ser menor a 10MB.",icon:"error"}),void(o.value="");const r=document.getElementById("upload-label"),n=r.querySelector(".upload-icon"),s=r.querySelector(".upload-spinner");n.classList.add("d-none"),s.classList.remove("d-none");const i=new FormData;i.append("file",o.files[0]),$.ajax({url:t,type:"POST",data:i,processData:!1,contentType:!1,success:function(e){Swal.fire({title:"Archivo subido",text:"El archivo se ha subido correctamente.",icon:"success"}),appendUploadedFile(e)},error:function(e,t,o){if(console.error(e,o),422==e.status){const{errors:t}=e.responseJSON;t.forEach(e=>{const t=$(`span[data-valmsg-for="${e.field}"]`);t.text(e.message)})}else Swal.fire({title:"Error al subir el archivo",text:o,icon:"error"})},complete:function(){setTimeout(()=>{n.classList.remove("d-none"),s.classList.add("d-none")},500)}})}function appendUploadedFile(e){const{fileName:t,originalFileName:o}=e;var a=o.length>120?o.slice(0,120)+"...":o,r=`<li class='list-box__item'><p><span>${a}</span></p></li>`;document.querySelector("ul#attachFiles");$("ul#attachFiles").append(r);const n=document.querySelector("#hiddenFileInputs"),s=$("ul#attachFiles li").length-1,i=document.createElement("input");i.type="hidden",i.name=`UploadedFiles[${s}][GuidName]`,i.value=t;const l=document.createElement("input");l.type="hidden",l.name=`UploadedFiles[${s}][OriginalName]`,l.value=o,n.appendChild(i),n.appendChild(l)}jQuery(document).ready(function(){displayMenu(),displayTable(),document.getElementsByClassName("nuevo-reporte-modal").length&&(modal=new bootstrap.Modal(document.getElementById("nuevo-reporte-modal")))});