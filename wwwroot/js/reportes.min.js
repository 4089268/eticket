function displayMenu(){$("#form-section").load("/reportes/partial-view/menu")}function displayForm(e){currentReportTypeId=e;const t=`/reportes/partial-view/formulario?tipoReporteId=${e}`;$("#body-modal").load(t,null,onFormularioLoadedCompleted)}function displayTable(){const e="/reportes/partial-view/ultimos-reportes";$("#table-section").load(e)}function onFormularioLoadedCompleted(e,t,o){$("#Observaciones").trumbowyg({svgPath:"../img/svg/icons.svg",btns:[["formatting"],["strong","em","del"],["superscript","subscript"],["link"],["base64"],["justifyLeft","justifyCenter","justifyRight","justifyFull"],["unorderedList","orderedList"],["emoji"]]}),modal.show()}function submitNuevoReporte(e){e.preventDefault();const t=document.getElementById("submit-button"),o=t.querySelector(".upload-icon"),a=t.querySelector(".upload-spinner");t.disabled=!0,o.classList.add("d-none"),a.classList.remove("d-none");const n="/reportes",r="POST",s=$(e.target);$("span.text-danger").text(""),$.ajax({url:n,type:r,data:s.serialize(),success:function(e){modal.hide();var{folio:t}=e;Swal.fire({title:"Reporte almacenado",text:`Folio: ${t}`,icon:"success",confirmButtonText:"Aceptar"}).then(e=>{window.location.reload()})},error:function(e,t,o){if(console.error(e,o),422==e.status){const{errors:t}=e.responseJSON;t.forEach(e=>{const t=$(`span[data-valmsg-for="${e.field}"]`);t.text(e.message)})}else{let t="Error no controlado al registrar la entrada";if(e.responseJSON){const{title:o}=e.responseJSON;o&&(t=o)}Swal.fire({title:t,icon:"error"})}},complete:function(){t.disabled=!1,o.classList.remove("d-none"),a.classList.add("d-none")}})}function uploadAttachFile(e){const t="/reportes/upload-attach-file",o=e.target;if(0===o.files.length)return;const a=10485760;if(o.files[0].size>a)return Swal.fire({title:"Archivo demasiado grande",text:"El archivo debe ser menor a 10MB.",icon:"error"}),void(o.value="");const n=document.getElementById("upload-label"),r=n.querySelector(".upload-icon"),s=n.querySelector(".upload-spinner");r.classList.add("d-none"),s.classList.remove("d-none");const l=new FormData;l.append("file",o.files[0]),$.ajax({url:t,type:"POST",data:l,processData:!1,contentType:!1,success:function(e){Swal.fire({title:"Archivo subido",text:"El archivo se ha subido correctamente.",icon:"success"}),appendUploadedFile(e)},error:function(e,t,o){if(console.error(e,o),422==e.status){const{errors:t}=e.responseJSON;t.forEach(e=>{const t=$(`span[data-valmsg-for="${e.field}"]`);t.text(e.message)})}else Swal.fire({title:"Error al subir el archivo",text:o,icon:"error"})},complete:function(){setTimeout(()=>{r.classList.remove("d-none"),s.classList.add("d-none")},500)}})}function appendUploadedFile(e){const{fileName:t,originalFileName:o}=e;var a=o.length>120?o.slice(0,120)+"...":o,n=`<li class='list-box__item'><p><span>${a}</span></p></li>`;document.querySelector("ul#attachFiles");$("ul#attachFiles").append(n);const r=document.querySelector("#hiddenFileInputs"),s=$("ul#attachFiles li").length-1,l=document.createElement("input");l.type="hidden",l.name=`UploadedFiles[${s}][GuidName]`,l.value=t;const i=document.createElement("input");i.type="hidden",i.name=`UploadedFiles[${s}][OriginalName]`,i.value=o,r.appendChild(l),r.appendChild(i)}async function getHashAndSave(){const e=await fetch("/api/reportes/ultimos-reportes-hash");if(!e.ok)throw new Error(e.statusText);return await e.text()}let intervalId=null;jQuery(document).ready(function(){displayMenu(),displayTable(),setInterval(async function(){try{const e=await getHashAndSave();ultimosReportesHash!==e&&(ultimosReportesHash=e,displayTable())}catch(e){clearInterval(intervalId),console.error(e)}},3e3),document.getElementsByClassName("nuevo-reporte-modal").length&&(modal=new bootstrap.Modal(document.getElementById("nuevo-reporte-modal")))});